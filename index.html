<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dr-Inovates</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <img src="pic1.jpeg" alt="Dr-Inovates Logo" style="width: 100%; height: auto;">
        <nav>
            <ul>
                <li><a href="#home">Home</a></li>
                <li><a href="#about">About</a></li>
                <li><a href="#services">Services</a></li>
                <li><a href="#contact">Contact</a></li>
            </ul>
        </nav>
    </header>

    <main>
        <section id="home">
            <h1>Welcome to Dr-Inovates</h1>
            <p>Your trusted partner in innovative medical solutions.</p>
        </section>

        <section id="about">
            <h2>About Dr-Inovates</h2>
            <p>Learn more about the doctor and the mission of Dr-Inovates.</p>
        </section>

        <section id="services">
            <h2>Our Services</h2>
            <p>Discover the services we offer to enhance your medical experience.</p>
        </section>

        <section id="contact">
            <h2>Contact Us</h2>
            <form>
                <label for="name">Name:</label>
                <input type="text" id="name" name="name">
                <label for="email">Email:</label>
                <input type="email" id="email" name="email">
                <textarea name="message" id="message" rows="4" placeholder="Your message"></textarea>
                <button type="submit">Send Message</button>
            </form>
        </section>

        <section id="voice-recording">
            <h2>Voice Recording</h2>
            <button id="startStream">Start Real-Time Transcription</button>
            <button id="stopStream" disabled>Stop</button>
            <textarea id="liveTranscript" rows="10" cols="80" readonly placeholder="Real-time transcript will appear here..."></textarea>
        </section>
    </main>

    <footer>
        <p>&copy; 2025 Dr-Inovates. All rights reserved.</p>
    </footer>

    <script src="https://sdk.amazonaws.com/js/aws-sdk-2.947.0.min.js"></script>
    <script src="https://unpkg.com/microphone-stream@6.1.0/dist/microphone-stream.min.js"></script>
    <script>
        AWS.config.region = 'ap-southeast-2';
        AWS.config.credentials = new AWS.CognitoIdentityCredentials({
            IdentityPoolId: 'ap-southeast-2:e1961e14-083d-4200-bb2b-c869a5ffbc3d'
        });

        let micStream = null;
        let socket;

        document.getElementById('startStream').addEventListener('click', async () => {
            document.getElementById('startStream').disabled = true;
            document.getElementById('stopStream').disabled = false;

            const mic = await navigator.mediaDevices.getUserMedia({ video: false, audio: true });
            micStream = new MicrophoneStream();
            micStream.setStream(mic);

            const creds = await AWS.config.credentials.getPromise();
            const url = `wss://transcribestreaming.${AWS.config.region}.amazonaws.com:8443/stream-transcription-websocket?language-code=en-US&media-encoding=pcm&sample-rate=16000&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=${encodeURIComponent(creds.accessKeyId + '/' + AWS.util.date.getDate(new Date()) + '/' + AWS.config.region + '/transcribe/aws4_request')}&X-Amz-Date=${AWS.util.date.iso8601(new Date()).replace(/[:\-]/g, '').replace(/\..+/, '')}&X-Amz-SignedHeaders=host&X-Amz-Security-Token=${encodeURIComponent(creds.sessionToken)}`;

            socket = new WebSocket(url);
            socket.binaryType = 'arraybuffer';

            socket.onopen = () => {
                const reader = micStream.getAudioStream().getReader();
                const pcmEncode = raw => {
                    const input = MicrophoneStream.toRaw(raw);
                    const buffer = new ArrayBuffer(input.length * 2);
                    const view = new DataView(buffer);
                    for (let i = 0; i < input.length; i++) view.setInt16(i * 2, input[i] * 0x7FFF, true);
                    return buffer;
                };
                const sendPCM = async () => {
                    while (true) {
                        const { done, value } = await reader.read();
                        if (done || socket.readyState !== 1) break;
                        if (value) socket.send(pcmEncode(value));
                    }
                };
                sendPCM();
            };

            socket.onmessage = message => {
                const data = JSON.parse(new TextDecoder('utf-8').decode(message.data));
                const results = data.Transcript?.Results;
                if (results?.length > 0 && results[0].Alternatives.length > 0) {
                    const transcript = results[0].Alternatives[0].Transcript;
                    if (!results[0].IsPartial) {
                        document.getElementById('liveTranscript').value += transcript + '\n';
                    }
                }
            };
        });

        document.getElementById('stopStream').addEventListener('click', () => {
            micStream.stop();
            if (socket && socket.readyState === 1) socket.close();
            document.getElementById('stopStream').disabled = true;
            document.getElementById('startStream').disabled = false;
        });
    </script>
</body>
</html>
